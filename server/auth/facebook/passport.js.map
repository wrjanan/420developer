{"version":3,"sources":["../../../../server/auth/facebook/passport.js"],"names":[],"mappings":";;;;;QAGgB;;AAHhB;;;;AACA;;;;AAEO,SAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,EAA6B;AAClC,qBAAS,GAAT,CAAa,+BAAqB;AAChC,cAAU,OAAO,QAAP,CAAgB,QAAhB;AACV,kBAAc,OAAO,QAAP,CAAgB,YAAhB;AACd,iBAAa,OAAO,QAAP,CAAgB,WAAhB;AACb,mBAAe,CACb,aADa,EAEb,QAFa,CAAf;GAJW,EASb,UAAS,WAAT,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,IAA7C,EAAmD;AACjD,SAAK,OAAL,CAAa,EAAC,eAAe,QAAQ,EAAR,EAA7B,EAA0C,IAA1C,GACG,IADH,CACQ,gBAAQ;AACZ,UAAI,IAAJ,EAAU;AACR,eAAO,KAAK,IAAL,EAAW,IAAX,CAAP,CADQ;OAAV;;AAIA,aAAO,IAAI,IAAJ,CAAS;AACd,cAAM,QAAQ,WAAR;AACN,eAAO,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB;AACP,cAAM,MAAN;AACA,kBAAU,UAAV;AACA,kBAAU,QAAQ,KAAR;OALL,CAAP,CALY;AAYZ,WAAK,IAAL,GACG,IADH,CACQ;eAAQ,KAAK,IAAL,EAAW,IAAX;OAAR,CADR,CAEG,KAFH,CAES;eAAO,KAAK,GAAL;OAAP,CAFT,CAZY;KAAR,CADR,CAiBG,KAjBH,CAiBS;aAAO,KAAK,GAAL;KAAP,CAjBT,CADiD;GAAnD,CATA,EADkC;CAA7B","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexport function setup(User, config) {\n  passport.use(new FacebookStrategy({\n    clientID: config.facebook.clientID,\n    clientSecret: config.facebook.clientSecret,\n    callbackURL: config.facebook.callbackURL,\n    profileFields: [\n      'displayName',\n      'emails'\n    ]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({'facebook.id': profile.id}).exec()\n      .then(user => {\n        if (user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          role: 'user',\n          provider: 'facebook',\n          facebook: profile._json\n        });\n        user.save()\n          .then(user => done(null, user))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"]}